# TripSage Operators Reference (frontend-only)

All runtime is Next.js 16 with AI SDK v6 route handlers.

## Prerequisites

- Node.js 24+, pnpm 9+
- Supabase project (URL, anon key, service role key, JWT secret)
- Upstash Redis + QStash
- Model provider keys or Vercel AI Gateway

## Environment Variables

Align with root `.env.example`:

| Category | Variables |
|----------|-----------|
| Core | `NODE_ENV`, `NEXT_PUBLIC_SITE_URL`, `NEXT_PUBLIC_API_URL`, `NEXT_PUBLIC_APP_NAME`, `NEXT_PUBLIC_BASE_PATH` |
| Supabase | `NEXT_PUBLIC_SUPABASE_URL`, `NEXT_PUBLIC_SUPABASE_ANON_KEY`, `SUPABASE_SERVICE_ROLE_KEY`, `SUPABASE_JWT_SECRET` |
| Upstash | `UPSTASH_REDIS_REST_URL`, `UPSTASH_REDIS_REST_TOKEN`, `QSTASH_TOKEN`, `QSTASH_CURRENT_SIGNING_KEY`, `QSTASH_NEXT_SIGNING_KEY` |
| AI | `AI_GATEWAY_API_KEY`, `AI_GATEWAY_URL`, `OPENAI_API_KEY`, `OPENROUTER_API_KEY`, `ANTHROPIC_API_KEY`, `XAI_API_KEY` |
| External | `GOOGLE_MAPS_SERVER_API_KEY`, `OPENWEATHERMAP_API_KEY`, `DUFFEL_ACCESS_TOKEN`, `RESEND_API_KEY` |

## Start and Verify

```bash
cp .env.example .env
pnpm install
pnpm dev
```

Quality gate: `pnpm biome:check && pnpm type-check && pnpm test:run`

## Operations CLI

The `pnpm ops` command provides infrastructure and configuration checks:

```bash
# Infrastructure checks
pnpm ops infra check supabase   # Auth health + storage (with service role key)
pnpm ops infra check upstash    # Redis ping + QStash topics probe

# AI configuration
pnpm ops ai check config        # Gateway/BYOK credential presence + reachability

# Combined
pnpm ops check all              # Run all checks with summary
```

Shorthand scripts:

```bash
pnpm ops:infra:supabase  # Supabase check
pnpm ops:infra:upstash   # Upstash check
pnpm ops:ai:config       # AI config check
pnpm ops:check           # All checks
```

### Test Analysis

```bash
pnpm ops test analyze failures  # Categorize failures from vitest JSON
pnpm ops test analyze all       # Failures + performance summary
```

Shorthand: `pnpm test:analyze`, `pnpm test:analyze:all`

Reads `.vitest-reports/vitest-report.json` (generated by `pnpm test:benchmark`).

## CI Integration

The deploy workflow runs `pnpm ops:check` as a non-blocking validation step
when Supabase/Upstash credentials are configured. See
`.github/workflows/deploy.yml`.

## Notes

- Rate limiting requires Upstash credentials; routes operate without limits
  if not configured.
- QStash signing keys are mandatory for webhook verification in production.
