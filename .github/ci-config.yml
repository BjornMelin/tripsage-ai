# Shared CI Configuration for TripSage AI (Next.js + AI SDK v6 only)

versions:
  node: "24"
  node-full: "24.x"
  pnpm: "10.20.0"
  biome: "2.3.2"
  playwright: "1.56.1"
  vitest: "4.0.6"
  typescript: "5.9.3"
  docker-buildx: "0.29.1"
  docker-compose: "2.40.3"

coverage:
  frontend:
    minimum: 85
    target: 90
    fail_under: 80
    precision: 2

security:
  vulnerability_scan:
    enabled: true
    fail_on_severity: "high"
    ignore_unfixed: false
  secret_scan:
    enabled: true
    fail_on_detection: true
  dependency_review:
    enabled: true
    fail_on_severity: "moderate"
    allow_licenses:
      - "MIT"
      - "Apache-2.0"
      - "BSD-3-Clause"
      - "BSD-2-Clause"
      - "ISC"
    deny_licenses:
      - "GPL-3.0"
      - "AGPL-3.0"
      - "LGPL-3.0"
  sast:
    enabled: true
    tools:
      - semgrep
      - trivy

performance:
  frontend:
    lighthouse_score: 90
    first_contentful_paint: 1800
    time_to_interactive: 3800
    cumulative_layout_shift: 0.1
  build:
    frontend_timeout: 600
    docker_timeout: 900

cache:
  node:
    key_prefix: "node-pnpm"
    restore_keys:
      - "node-pnpm-${{ runner.os }}-${{ hashFiles('frontend/pnpm-lock.yaml') }}"
      - "node-pnpm-${{ runner.os }}-"
    paths:
      - "~/.pnpm-store"
      - "frontend/node_modules"
      - "frontend/.next/cache"
  docker:
    key_prefix: "docker-buildx"
    registry: "ghcr.io"
    mode: "max"
    compression: "zstd"

matrix:
  os:
    default: ["ubuntu-latest"]
    full: ["ubuntu-latest", "macos-latest", "windows-latest"]
  node_versions:
    default: ["24"]
    full: ["20", "22", "24"]

concurrency:
  cancel_in_progress: true
  groups:
    pr: "ci-${{ github.workflow }}-${{ github.event.pull_request.number }}"
    push: "ci-${{ github.workflow }}-${{ github.ref }}"

artifacts:
  retention_days:
    test_results: 30
    coverage_reports: 90
    build_artifacts: 7
    logs: 14
  size_limits:
    single_file: 100
    total_upload: 500

notifications:
  slack:
    enabled: true
    webhook_secret: "SLACK_WEBHOOK_URL"
    channels:
      success: "#ci-success"
      failure: "#ci-alerts"
      security: "#security-alerts"
  status_checks:
    required:
      - "Frontend Tests"
      - "Type Check"
      - "Lint"
      - "Security Scan"
      - "Build"

environments:
  development:
    url: "https://dev.tripsage.ai"
    protection_rules:
      required_reviewers: 0
  staging:
    url: "https://staging.tripsage.ai"
    protection_rules:
      required_reviewers: 1
      dismiss_stale_reviews: true
  production:
    url: "https://tripsage.ai"
    protection_rules:
      required_reviewers: 2
      dismiss_stale_reviews: true
      require_code_owner_reviews: true
      required_status_checks:
        - "All Tests"
        - "Security Scan"
        - "Build"

secrets:
  deploy: []

release:
  versioning:
    schema: "semantic"
    initial_version: "0.1.0"
  changelog:
    enabled: true
    categories:
      - title: "Added"
        labels: ["feat", "enhancement"]
      - title: "Changed"
        labels: ["refactor", "perf", "style", "test", "revert"]
      - title: "Fixed"
        labels: ["bug", "fix"]
      - title: "Removed"
        labels: []
      - title: "Security"
        labels: ["security"]
      - title: "Breaking Changes"
        labels: []
      - title: "Documentation"
        labels: ["docs"]
      - title: "Maintenance"
        labels: ["chore", "build", "ci"]

timeouts:
  default: 30
  test: 20
  build: 15
  deploy: 45
  e2e: 60
